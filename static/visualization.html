<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>視覺化分析 - 飲料社群粉絲專頁分析</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- 引入Plotly.js用於互動式圖表 -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <!-- 添加Font Awesome圖標 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <header>
        <h1>飲料社群粉絲專頁視覺化分析</h1>
        <nav>
            <ul>
                <li><a href="../index.html"><i class="fas fa-home"></i> 首頁</a></li>
                <li><a href="analysis.html"><i class="fas fa-chart-bar"></i> 品牌比較</a></li>
                <li><a href="visualization.html" class="active"><i class="fas fa-chart-line"></i> 視覺化分析</a></li>
            </ul>
        </nav>
    </header>

    <main class="analysis-content">
        <section class="section-intro">
            <h2><i class="fas fa-robot"></i> 機器學習分析與視覺化</h2>
            <p>這個頁面展示了我們使用機器學習和自然語言處理技術對飲料品牌社群數據的分析結果。以下分析基於情感分析、互動率、熱度分數等指標。</p>
        </section>

        <section class="chart-section sentiment-section">
            <h3><i class="fas fa-smile"></i> 情感分析與熱度關係</h3>
            <div class="brand-selector">
                <label for="brandSelect">選擇品牌：</label>
                <select id="brandSelect">
                    <!-- 品牌選項將由JavaScript動態生成 -->
                </select>
            </div>
            <div id="sentiment-popularity-chart" class="chart-container"></div>
            <p class="chart-description">情感分數（0=負面、1=正面）與貼文熱度分數（按讚+2×留言+3×分享）的關係</p>
        </section>

        <section class="chart-section model-section">
            <h3><i class="fas fa-chart-bar"></i> 模型性能比較</h3>
            <div id="model-comparison-chart" class="chart-container"></div>
            <p class="chart-description">不同機器學習模型在預測貼文熱門度時的表現指標</p>
        </section>

        <section class="chart-section feature-section">
            <h3><i class="fas fa-th-list"></i> 特徵重要性</h3>
            <div id="feature-importance-chart" class="chart-container"></div>
            <p class="chart-description">不同特徵（按讚、留言、分享、情感分數）對預測貼文熱門度的影響程度</p>
        </section>

        <section class="chart-section methodology-section">
            <h3><i class="fas fa-microscope"></i> 分析方法說明</h3>
            <div class="method-grid">
                <div class="method-card">
                    <div class="method-icon"><i class="fas fa-fire-alt"></i></div>
                    <h4>熱度分數計算</h4>
                    <p>每則貼文的熱度分數計算方式為：<br>按讚 + 2×留言 + 3×分享</p>
                    <p>給予留言和分享更高權重，因為這些互動行為顯示更高的用戶參與度。</p>
                </div>
                <div class="method-card">
                    <div class="method-icon"><i class="fas fa-heart"></i></div>
                    <h4>情感分析</h4>
                    <p>使用中文自然語言處理工具對每則貼文內容進行情感分析，分數介於0-1之間。</p>
                    <p>分數越高代表情感越正面，分數越低代表情感越負面。</p>
                </div>
                <div class="method-card">
                    <div class="method-icon"><i class="fas fa-tag"></i></div>
                    <h4>熱門貼文標籤</h4>
                    <p>將所有貼文依熱度分數排序，熱度分數前25%的貼文標記為「熱門」。</p>
                    <p>機器學習模型用於預測貼文是否會成為熱門貼文。</p>
                </div>
                <div class="method-card">
                    <div class="method-icon"><i class="fas fa-check-square"></i></div>
                    <h4>模型評估指標</h4>
                    <p>Accuracy（準確率）：預測正確的比例</p>
                    <p>Precision（精確度）：預測為熱門中實際為熱門的比例</p>
                    <p>Recall（召回率）：實際熱門中被正確預測的比例</p>
                    <p>F1-Score：精確度與召回率的調和平均</p>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <p>&copy; 飲料社群粉絲專頁分析 | 機器學習概論專案</p>
        <div class="footer-links">
            <a href="#"><i class="fas fa-code"></i> GitHub</a>
            <a href="#"><i class="fas fa-book"></i> 專案報告</a>
        </div>
    </footer>

    <script>
        // 設定Plotly深色主題（全域變數）
        const darkTemplate = {
            paper_bgcolor: '#252525',
            plot_bgcolor: '#252525',
            font: {
                color: '#e8e8e8'
            },
            xaxis: {
                gridcolor: 'rgba(255, 255, 255, 0.1)',
                zerolinecolor: 'rgba(255, 255, 255, 0.1)'
            },
            yaxis: {
                gridcolor: 'rgba(255, 255, 255, 0.1)',
                zerolinecolor: 'rgba(255, 255, 255, 0.1)'
            },
            legend: {
                bgcolor: '#252525'
            }
        };
        
        // 情感分析與熱度圖表
        function updateSentimentChart(brand) {
            // 顯示加載中的訊息
            document.getElementById('sentiment-popularity-chart').innerHTML = 
                '<div class="loading-message"><i class="fas fa-spinner fa-spin"></i> 正在載入數據...</div>';
                
            fetch(`data/brand_sentiment_${brand}.json`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP 錯誤 ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data || data.length === 0) {
                        throw new Error('沒有可用的數據');
                    }
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // 先清空容器，移除載入訊息
                    document.getElementById('sentiment-popularity-chart').innerHTML = '';
                    
                    const trace = {
                        x: data.map(item => item.sentiment_score),
                        y: data.map(item => item.popularity_score),
                        mode: 'markers',
                        type: 'scatter',
                        marker: {
                            size: 12,
                            color: data.map(item => item.popularity_score),
                            colorscale: 'Viridis',
                            showscale: true,
                            colorbar: {
                                title: '熱度分數',
                                titlefont: {
                                    color: '#e8e8e8'
                                },
                                tickfont: {
                                    color: '#e8e8e8'
                                }
                            },
                            opacity: 0.8,
                            line: {
                                width: 1,
                                color: 'rgba(255, 255, 255, 0.2)'
                            }
                        },
                        text: data.map(item => 
                            `內容: ${item.content || '無內容'}<br>` +
                            `按讚: ${item.like || 0}<br>` +
                            `留言: ${item.comment || 0}<br>` +
                            `分享: ${item.share || 0}<br>` +
                            `熱度: ${item.popularity_score || 0}`
                        ),
                        hoverinfo: 'text'
                    };

                    const layout = {
                        title: `${brand} 品牌貼文情感分數與熱度關係`,
                        xaxis: {
                            title: '情感分數 (0=負面, 1=正面)',
                            gridcolor: darkTemplate.xaxis.gridcolor,
                            zerolinecolor: darkTemplate.xaxis.zerolinecolor
                        },
                        yaxis: {
                            title: '熱度分數',
                            gridcolor: darkTemplate.yaxis.gridcolor,
                            zerolinecolor: darkTemplate.yaxis.zerolinecolor
                        },
                        hovermode: 'closest',
                        paper_bgcolor: darkTemplate.paper_bgcolor,
                        plot_bgcolor: darkTemplate.plot_bgcolor,
                        font: darkTemplate.font
                    };

                    Plotly.newPlot('sentiment-popularity-chart', [trace], layout);
                })
                .catch(error => {
                    console.error('獲取數據失敗:', error);
                    document.getElementById('sentiment-popularity-chart').innerHTML = 
                        `<div class="error-container">
                            <p class="error"><i class="fas fa-exclamation-triangle"></i> 無法載入數據。${error.message}</p>
                            <button class="retry-btn" onclick="updateSentimentChart('${brand}')">
                                <i class="fas fa-redo"></i> 重試
                            </button>
                        </div>`;
                });
        }

        // 模型比較圖表
        function loadModelComparisonChart() {
            // 顯示加載中的訊息
            document.getElementById('model-comparison-chart').innerHTML = 
                '<div class="loading-message"><i class="fas fa-spinner fa-spin"></i> 正在載入數據...</div>';
                
            fetch('data/popularity_model_comparison.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP 錯誤 ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data || Object.keys(data).length === 0) {
                        throw new Error('沒有可用的模型比較數據');
                    }
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // 先清空容器，移除載入訊息
                    document.getElementById('model-comparison-chart').innerHTML = '';
                    
                    const models = Object.keys(data);
                    const metrics = ['Accuracy', 'Precision', 'Recall', 'F1-Score'];
                    const colors = ['#4fa8ff', '#ff6b9d', '#4caf50', '#ff9800'];
                    
                    const traces = metrics.map((metric, i) => {
                        return {
                            x: models,
                            y: models.map(model => data[model][metric]),
                            name: metric,
                            type: 'bar',
                            marker: {
                                color: colors[i % colors.length],
                                line: {
                                    width: 1,
                                    color: 'rgba(255, 255, 255, 0.2)'
                                }
                            }
                        };
                    });

                    const layout = {
                        title: '不同模型預測熱門貼文的表現比較',
                        barmode: 'group',
                        xaxis: {
                            title: '模型',
                            gridcolor: darkTemplate.xaxis.gridcolor,
                            zerolinecolor: darkTemplate.xaxis.zerolinecolor
                        },
                        yaxis: {
                            title: '分數',
                            range: [0, 1],
                            gridcolor: darkTemplate.yaxis.gridcolor,
                            zerolinecolor: darkTemplate.yaxis.zerolinecolor
                        },
                        legend: {
                            orientation: 'h',
                            y: -0.2,
                            bgcolor: darkTemplate.legend.bgcolor
                        },
                        paper_bgcolor: darkTemplate.paper_bgcolor,
                        plot_bgcolor: darkTemplate.plot_bgcolor,
                        font: darkTemplate.font
                    };

                    Plotly.newPlot('model-comparison-chart', traces, layout);
                })
                .catch(error => {
                    console.error('獲取數據失敗:', error);
                    document.getElementById('model-comparison-chart').innerHTML = 
                        `<div class="error-container">
                            <p class="error"><i class="fas fa-exclamation-triangle"></i> 無法載入數據。${error.message}</p>
                            <button class="retry-btn" onclick="loadModelComparisonChart()">
                                <i class="fas fa-redo"></i> 重試
                            </button>
                        </div>`;
                });
        }

        // 特徵重要性圖表
        function loadFeatureImportanceChart() {
            // 顯示加載中的訊息
            document.getElementById('feature-importance-chart').innerHTML = 
                '<div class="loading-message"><i class="fas fa-spinner fa-spin"></i> 正在載入數據...</div>';
                
            fetch('data/feature_importance.json')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP 錯誤 ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data || Object.keys(data).length === 0) {
                        throw new Error('沒有可用的特徵重要性數據');
                    }
                    if (data.error) {
                        throw new Error(data.error);
                    }
                    
                    // 先清空容器，移除載入訊息
                    document.getElementById('feature-importance-chart').innerHTML = '';
                    
                    const features = Object.keys(data);
                    const values = features.map(feat => data[feat]);

                    const trace = {
                        x: features,
                        y: values,
                        type: 'bar',
                        marker: {
                            color: '#4fa8ff',
                            line: {
                                color: 'rgba(255, 255, 255, 0.3)',
                                width: 1.5
                            }
                        },
                        text: values.map(val => (val * 100).toFixed(1) + '%'),
                        textposition: 'auto',
                        textfont: {
                            color: '#e8e8e8'
                        }
                    };

                    const layout = {
                        title: '預測貼文熱門度的特徵重要性',
                        xaxis: {
                            title: '特徵',
                            gridcolor: darkTemplate.xaxis.gridcolor,
                            zerolinecolor: darkTemplate.xaxis.zerolinecolor
                        },
                        yaxis: {
                            title: '重要性 (比例)',
                            range: [0, Math.max(...values) * 1.1],
                            gridcolor: darkTemplate.yaxis.gridcolor,
                            zerolinecolor: darkTemplate.yaxis.zerolinecolor
                        },
                        paper_bgcolor: darkTemplate.paper_bgcolor,
                        plot_bgcolor: darkTemplate.plot_bgcolor,
                        font: darkTemplate.font
                    };

                    Plotly.newPlot('feature-importance-chart', [trace], layout);
                })
                .catch(error => {
                    console.error('獲取數據失敗:', error);
                    document.getElementById('feature-importance-chart').innerHTML = 
                        `<div class="error-container">
                            <p class="error"><i class="fas fa-exclamation-triangle"></i> 無法載入數據。${error.message}</p>
                            <button class="retry-btn" onclick="loadFeatureImportanceChart()">
                                <i class="fas fa-redo"></i> 重試
                            </button>
                        </div>`;
                });
        }

        // 載入品牌選項
        function loadBrandOptions() {
            fetch('data/brands.json')
                .then(response => response.json())
                .then(brands => {
                    const brandSelect = document.getElementById('brandSelect');
                    
                    // 清空現有選項
                    brandSelect.innerHTML = '';
                    
                    // 按名稱排序品牌
                    brands.sort((a, b) => a.name.localeCompare(b.name));
                    
                    // 添加選項
                    brands.forEach(brand => {
                        const option = document.createElement('option');
                        option.value = brand.name;
                        option.textContent = brand.name;
                        brandSelect.appendChild(option);
                    });
                    
                    // 初始加載第一個品牌的圖表
                    if (brands.length > 0) {
                        updateSentimentChart(brands[0].name);
                    }
                })
                .catch(error => {
                    console.error('載入品牌選項失敗:', error);
                    document.getElementById('brandSelect').innerHTML = 
                        '<option value="">無法載入品牌</option>';
                });
        }

        // 頁面載入後初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 選擇品牌下拉框監聽
            const brandSelect = document.getElementById('brandSelect');
            brandSelect.addEventListener('change', function() {
                updateSentimentChart(this.value);
            });

            // 初始加載
            loadBrandOptions();
            loadModelComparisonChart();
            loadFeatureImportanceChart();
        });
    </script>
</body>
</html> 